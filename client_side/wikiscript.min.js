var sentence_parser=function(a){"use strict";var b=function(a){var b=a.match(/\[\[/)||[],c=a.match(/\]\]/)||[];if(b.length>c.length)return!0;var d=a.match(/"/g);return d&&d.length%2!=0&&a.length<900?!0:!1},c=a.split(/(\S.+?[.\?])(?=\s+|$|")/g),d=[],e=["jr","mr","mrs","ms","dr","prof","sr","sen","corp","calif","rep","gov","atty","supt","det","rev","col","gen","lt","cmdr","adm","capt","sgt","cpl","maj","dept","univ","assn","bros","inc","ltd","co","corp","arc","al","ave","blvd","cl","ct","cres","exp","rd","st","dist","mt","ft","fy","hwy","la","pd","pl","plz","tce","Ala","Ariz","Ark","Cal","Calif","Col","Colo","Conn","Del","Fed","Fla","Ga","Ida","Id","Ill","Ind","Ia","Kan","Kans","Ken","Ky","La","Me","Md","Mass","Mich","Minn","Miss","Mo","Mont","Neb","Nebr","Nev","Mex","Okla","Ok","Ore","Penna","Penn","Pa","Dak","Tenn","Tex","Ut","Vt","Va","Wash","Wis","Wisc","Wy","Wyo","USAFA","Alta","Ont","QuÔøΩ","Sask","Yuk","jan","feb","mar","apr","jun","jul","aug","sep","oct","nov","dec","sept","vs","etc","esp","llb","md","bl","phd","ma","ba","miss","misses","mister","sir","esq","mstr","lit","fl","ex","eg","sep","sept",".."],f=new RegExp("(^| )("+e.join("|")+")[.] ?$","i");for(var g in c)c[g]&&(c[g]=c[g].replace(/^\s+|\s+$/g,""),c[g].match(f)||c[g].match(/[ |\.][A-Z]\.?$/i)||b(c[g])?c[parseInt(g)+1]=c[g]+" "+c[parseInt(g)+1]:(d.push(c[g]),c[g]=""));var h=[];for(g in d)d[g]=d[g].replace(/^\s+|\s+$/g,""),d[g]=d[g].replace(/  /g," "),d[g]&&h.push(d[g]);return 0==h.length?[a]:h};"undefined"!=typeof module&&module.exports&&(module.exports=sentence_parser);var wtf_wikipedia=function(){"use strict";function a(a,b,c){for(var d=[],e=[],f=c.split(""),g=0,h=0;h<f.length;h++){if(f[h]==a&&f[h+1]&&f[h+1]==a&&(g+=1),g>=0&&e.push(f[h]),0>=g&&e.length>0){var i=e.filter(function(b){return b==a}),j=e.filter(function(a){return a==b});i.length>j.length&&e.push(b),d.push(e.join("")),e=[]}f[h]==b&&f[h+1]&&f[h+1]==b&&(g-=1,0>g&&(g=0))}return d}function b(a){var b=[],c=a.match(/\[\[(.{2,80}?)\]\](\w{0,10})/g);return c&&c.forEach(function(a){var c,d;if(a.match(/\|/)?(a=a.replace(/\[\[(.{2,80}?)\]\](\w{0,10})/g,"$1$2"),c=a.replace(/(.{2,60})\|.{0,200}/,"$1"),d=a.replace(/.{2,60}?\|/,""),!d&&c.match(/\|$/)&&(c=c.replace(/\|$/,""),d=c)):c=a.replace(/\[\[(.{2,60}?)\]\](\w{0,10})/g,"$1"),!c.match(/^:?(category|catégorie|Kategorie|Categoría|Categoria|Categorie|Kategoria|تصنيف|image|file|image|fichier|datei|media|special|wp|wikipedia|help|user|mediawiki|portal|talk|template|book|draft|module|topic|wiktionary|wikisource):/i)&&!c.match(/^#/i)){c=c.replace(/#[^ ]{1,100}/,""),c=r.capitalise(c);var e={page:c,src:d};b.push(e)}}),b=b.filter(r.onlyUnique),0==b.length?void 0:b}function c(a){var b=[],c=new RegExp("\\[\\[:?("+o.join("|")+"):(.{2,60}?)]](w{0,10})","ig"),d=a.match(c);if(d){var e=new RegExp("^\\[\\[:?("+o.join("|")+"):","ig");d.forEach(function(a){a=a.replace(e,""),a=a.replace(/\|?[ \*]?\]\]$/i,""),a&&!a.match(/[\[\]]/)&&b.push(a)})}return b}function d(a){var b=/\[\[:?(category|catégorie|Kategorie|Categoría|Categoria|Categorie|Kategoria|تصنيف):[^\]\]]{2,80}\]\]/gi;return a=a.replace(b,""),a=a.replace(/\[\[:?([^|]{2,80}?)\]\](\w{0,5})/g,"$1$2"),a=a.replace(/\[\[:?(.{2,80}?)\|([^\]]+?)\]\](\w{0,5})/g,"$2$3"),a=a.replace(/\[(https?|news|ftp|mailto|gopher|irc):\/\/[^\]\| ]{4,1500}([\| ].*?)?\]/g,"$2")}function e(a){return a=a.match(/(file|image):.*?[\|\]]/i)||[""],a=a[0].replace(/\|$/,"")}function f(a){var b={};return a&&(a=a.replace(/\{\{Collapsible list[^\}]{10,1000}\}\}/g,""),a.replace(/\r/g,"").split(/\n/).forEach(function(a){if(a.match(/^\|/)){var c=a.match(/^\| ?(.{1,200}?)[ =]/)||[];c=r.trim_whitespace(c[1]||"");var d=a.match(/=(.{1,500})$/)||[];d=r.trim_whitespace(d[1]||""),c&&c.match(/[\.]/)&&(c=null),c&&d&&!d.match(/^[\|<]/)&&!d.match(/=/)&&(b[c]=h(d),b[c].text&&b[c].text.match(/^[0-9,]*$/)&&(b[c].text=b[c].text.replace(/,/g),b[c].text=parseInt(b[c].text)))}})),b}function g(a){return a=a.replace(/<!--[^>]{0,2000}-->/g,""),a=a.replace(/__(NOTOC|NOEDITSECTION|FORCETOC|TOC)__/gi,""),a=a.replace(/~~{1,3}/,""),a=a.replace(/--{1,3}/,""),a=a.replace(/&nbsp;/g," "),a=a.replace(/\[\[([a-z][a-z]|simple|war|ceb|min):.{2,60}\]\]/i,""),a=a.replace(/''{0,3}([^']{0,200})''{0,3}/g,"$1"),a=j(a)}function h(a){return{text:i(a),links:b(a)}}function i(a){return a=d(a),a.match(/^(thumb|right|left)\|/i)?void 0:(a=a.replace(/\([^a-z]{0,8}\)/,""),a=r.trim_whitespace(a))}function j(a){return a=a.replace(/<ref>[\s\S]{0,500}?<\/ref>/gi," "),a=a.replace(/<ref [^>]{0,200}?\/>/gi," "),a=a.replace(/<ref [^>]{0,200}?>[\s\S]{0,500}?<\/ref>/gi," "),a=a.replace(/< ?(table|code|score|data|categorytree|charinsert|gallery|hiero|imagemap|inputbox|math|nowiki|poem|references|source|syntaxhighlight|timeline) ?[^>]{0,200}?>[\s\S]{0,700}< ?\/ ?(table|code|score|data|categorytree|charinsert|gallery|hiero|imagemap|inputbox|math|nowiki|poem|references|source|syntaxhighlight|timeline) ?>/gi," "),a=a.replace(/< ?(ref|span|div|table|data) [a-z0-9=" ]{2,20}\/ ?>/g," "),a=a.replace(/<[ \/]?(p|sub|sup|span|nowiki|div|table|br|tr|td|th|pre|pre2|hr)[ \/]?>/g," "),a=a.replace(/<[ \/]?(abbr|bdi|bdo|blockquote|cite|del|dfn|em|i|ins|kbd|mark|q|s)[ \/]?>/g," "),a=a.replace(/<[ \/]?h[0-9][ \/]?>/g," "),a=a.replace(/<[ \/]?[a-z0-9]{1,8}[ \/]?>/g," ")}if("undefined"!=typeof module&&module.exports)var k=require("./lib/sentence_parser"),l=require("./fetch_text");var m=["disambig","disambiguation","dab","disamb","begriffsklärung","ujednoznacznienie","doorverwijspagina","消歧义","desambiguación","dubbelsinnig","disambigua","desambiguação","homonymie","неоднозначность","anlam ayrımı"],n=["infobox","ficha","канадский","inligtingskas","inligtingskas3","لغة","bilgi kutusu","yerleşim bilgi kutusu"],o=["category","catégorie","kategorie","categoría","categoria","categorie","kategoria","تصنيف","kategori"],p=["redirect","redirection","weiterleitung","redirecci[oó]n","重定向","yönlendirm?e?","преусмери","aýdaw","айдау","tilvísun","ohjaus","uudelleenohjaus","تغییر_مسیر","تغییرمسیر","přesměruj","перанакіраваньне","doorverwijzing","yönlendirme"],q=new RegExp("^ ?#("+p.join("|")+") ?\\[\\[(.{2,60}?)\\]\\]","i"),r={capitalise:function(a){return a&&"string"==typeof a?a.charAt(0).toUpperCase()+a.slice(1):void 0},onlyUnique:function(a,b,c){return c.indexOf(a)===b},trim_whitespace:function(a){return a&&"string"==typeof a?(a=a.replace(/^\s\s*/,""),a=a.replace(/\s\s*$/,""),a=a.replace(/  /," "),a=a.replace(/\s, /,", ")):void 0}},s=function(a){a=a.replace(/\{\{URL\|([^ ]{4,100}?)\}\}/gi,"$1"),a=a.replace(/\{\{convert\|([0-9]*?)\|([^\|]*).*?\}\}/gi,"$1 $2");var b=new Date;a=a.replace(/\{\{(CURRENT|LOCAL)DAY(2)?\}\}/gi,b.getDate());var c=["January","February","March","April","May","June","July","August","September","October","November","December"];a=a.replace(/\{\{(CURRENT|LOCAL)MONTH(NAME|ABBREV)?\}\}/gi,c[b.getMonth()]),a=a.replace(/\{\{(CURRENT|LOCAL)YEAR\}\}/gi,b.getFullYear());var d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(a=a.replace(/\{\{(CURRENT|LOCAL)DAYNAME\}\}/gi,d[b.getDay()]),a=a.replace(/\{\{(lc|uc|formatnum):(.*?)\}\}/gi,"$2"),a=a.replace(/\{\{pull quote\|([\s\S]*?)(\|[\s\S]*?)?\}\}/gi,"$1"),a=a.replace(/\{\{cquote\|([\s\S]*?)(\|[\s\S]*?)?\}\}/gi,"$1"),a.match(/\{\{dts\|/)){var e=(a.match(/\{\{dts\|(.*?)[\}\|]/)||[])[1]||"";console.log(e),e=new Date(e),a=e&&e.getTime()?a.replace(/\{\{dts\|.*?\}\}/gi,e.toDateString()):a.replace(/\{\{dts\|.*?\}\}/gi," ")}return a},t=function(a){var c=[],d=a.replace(/\r/g,"").split(/\n/);return d.forEach(function(a){if(a.match(/^\*.{0,40}\[\[.*\]\]/)){var d=b(a);d&&d[0]&&d[0].page&&c.push(d[0].page)}}),{type:"disambiguation",pages:c}},u=function(a){var b=[],c=a.replace(/\r/g,"").split(/\n/);return c.forEach(function(a){if(!a.match(/^\|\}/)){if(a.match(/^\|-/))return void b.push([]);if(!a.match(/^\|\+/)&&a.match(/^[\!\|]/)){b[b.length-1]||(b[b.length-1]=[]);var c=(a.match(/\|(.*)/)||[])[1]||"";c=r.trim_whitespace(c)||"",c.match(/[!\|]{2}/)?c.split(/[!\|]{2}/g).forEach(function(a){a=r.trim_whitespace(a),b[b.length-1].push(a)}):b[b.length-1].push(c)}}}),b},v=function(b){var d={},i=[],j=[];if(b=b||"",b.match(q))return{type:"redirect",redirect:(b.match(q)||[])[2]};var l=new RegExp("\\{\\{ ?("+m.join("|")+")(\\|[a-z =]*?)? ?\\}\\}","i");if(b.match(l))return t(b);b=s(b),b=g(b),j=b.match(/\{\|[\s\S]{1,8000}?\|\}/g,"")||[],j=j.map(function(a){return u(a)}),b=b.replace(/\{\|[\s\S]{1,8000}?\|\}/g,"");var o=a("{","}",b),p=new RegExp("{{("+n.join("|")+")[: \n]","ig");o.forEach(function(a){a.match(p,"ig")&&0==Object.keys(d).length&&(d=f(a)),a.match(/\{\{(cite|infobox|Inligtingskas|sister|geographic|navboxes|listen|historical|citeweb|citenews|lien|clima|cita|Internetquelle|article|weather)[ \|:\n]/i)&&(b=b.replace(a,""))}),o=a("[","]",b),o.forEach(function(a){a.match(/\[\[(file|image|fichier|datei|plik)/i)&&(i.push(e(a)),b=b.replace(a,""))}),b=b.replace(/\{\{.*?\}\}/g,"");var v=c(b),w={},x=b.replace(/\r/g,"").split(/\n/),y="Intro";if(x.forEach(function(a){return y&&!a.match(/^[\*#:;\|]/)&&a.match(/[a-z0-9]/i)?a.match(/^={1,5}[^=]{1,200}={1,5}$/)?(y=a.match(/^={1,5}([^=]{2,200}?)={1,5}$/)||[],y=y[1]||"",y=y.replace(/\./g," "),y=r.trim_whitespace(y),void(y&&y.match(/^(references|see also|external links|further reading|Notes et références|Voir aussi|Liens externes)$/i)&&(y=void 0))):void k(a).forEach(function(a){a=h(a),a&&a.text&&(w[y]||(w[y]=[]),w[y].push(a))}):void 0}),d.image&&d.image.text){var z=d.image.text||"";z.match(/^(image|file|fichier|Datei)/i)||(z="File:"+z),i.push(z)}return{type:"page",text:w,categories:v,images:i,infobox:d,tables:j}},w=function(a,b,c){return"function"==typeof b&&(c=b,b="en"),c=c||console.log,b=b||"en",l?void l(a,b,c):c(null)},x=function(a){var b=v(a)||{};return b.text=b.text||{},Object.keys(b.text).map(function(a){return b.text[a].map(function(a){return a.text}).join(" ")}).join("\n")},y={from_api:w,parse:v,plaintext:x};return"undefined"!=typeof module&&module.exports&&(module.exports=y),y}();